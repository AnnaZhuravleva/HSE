We develop a general theory to estimate magnetic field gradients in quantum metrology. We consider a system of $N$ particles distributed on a line whose internal degrees of freedom interact with a magnetic field. Usually gradient estimation is based on precise measurements of the magnetic field at two different locations, performed with two independent groups of particles. This approach, however, is sensitive to fluctuations of the off-set field determining the level-splitting of the particles and results in collective dephasing. In this work we use the framework of quantum metrology to assess the maximal accuracy for gradient estimation. For arbitrary positioning of particles, we identify optimal entangled and separable states allowing the estimation of gradients with the maximal accuracy, quantified by the quantum Fisher information. We also analyze the performance of states from the decoherence-free subspace (DFS), which are insensitive to the fluctuations of the magnetic offset field. We find that these states allow to measure a gradient directly, without the necessity of estimating the magnetic offset field. Moreover, we show that DFS states attain a precision for gradient estimation comparable to the optimal entangled states. Finally, for the above classes of states we find simple and feasible measurements saturating the quantum Cram\'er-Rao bound.