Quantum key distribution (QKD) provides secure keys resistant to code-breaking quantum computers. As headed towards commercial application, it is crucial to guarantee the practical security of QKD systems. However, the difficulty of security proof limits the flexibility of protocol proposals, which may not fulfill with real application requirements. Here we show a protocol design framework that allows one to securely construct the protocol using arbitrary non-orthogonal states. Multi-mode entangled source is virtually introduced for the security analysis, while coherent measurement is used to provide raw data. This 'arbitrary' feature reverses the traditional protocol-decide-the-system working style, such that the protocol design now can follow what the system generates. We show a valuable showcase, which not only solves the security challenge of discrete-modulated coherent states, but also achieves high performance with no more than 256 coherent states. Our findings lower the requirement for system venders with off-the-shell devices, thus will promote the commercialization of QKD.