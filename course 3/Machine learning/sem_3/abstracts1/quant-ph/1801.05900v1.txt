Based on Lyapunov control theory in closed and open systems, we propose a scheme to generate W state of many distant atoms in the cavity-fiber-cavity system. In the closed system, the W state is generated successfully even when the coupling strength between the cavity and fiber is extremely weak. In the presence of atomic spontaneous emission or cavity and fiber decay, the photon-measurement and quantum feedback approaches are proposed to improve the fidelity, which enable efficient generation of high-fidelity W state in the case of large dissipation. Furthermore, the time-optimal Lyapunov control is investigated to shorten the evolution time and improve the fidelity in open systems.