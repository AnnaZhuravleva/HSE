We present ESO/VLT spectra in the 2.9-4.1 micron range for a large sample of infrared stars in the Small Magellanic Cloud (SMC), mainly carbon stars, massive oxygen-rich Asymptotic Giant Branch (AGB) stars, and red supergiants. Strong emission from Polycyclic Aromatic Hydrocarbons (PAHs) is detected in the spectrum of the post-AGB object MSX SMC 29. Water ice is detected in at least one Young Stellar Object, IRAS 01042-7215, for the first time in the SMC. The strength and shapes of the molecular bands detected in the evolved stars are compared with similar data for stars in the Large Magellanic Cloud (LMC). Absorption from acetylene in carbon stars is found to be equally strong in the SMC as in the LMC, but the LMC stars show stronger dust emission in their infrared colours and veiling of the molecular bands. This suggests that a critical link exists in the formation of dust from the molecular atmosphere in carbon stars which scales with the initial metallicity. Nucleation seeds based on a secondary element such as titanium or silicon provide a plausible explanation. In oxygen-rich stars, both the nucleation seeds and molecular condensates depend on secondary elements (in particular titanium, silicon, and/or aluminium). Data for pulsating dusty AGB stars and supergiants in the LMC are used to show that pulsation is likely the critical factor in driving mass loss, as long as dust forms, rather than the stellar luminosity. Finally, we suggest that the reduced dust production and consequently slower winds of metal-poor AGB stars and red supergiants are more likely to result in chemical inhomogeneities and small-scale structure in the interstellar medium. (abridged)