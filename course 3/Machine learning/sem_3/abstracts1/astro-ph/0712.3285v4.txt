We develop a new realistic prescription for modeling the stellar feedback, which minimizes any ad hoc assumptions about sub-grid physics. We start with developing high resolution models of the ISM and formulate the conditions required for its realistic functionality: formation of multi-phase medium with hot chimneys, super-bubbles, cold molecular phase, and very slow consumption of gas. Another important ingredient is the runaway stars. They greatly facilitate the feedback. Once these effects are implemented into cosmological simulations, we do not have the overcooling problem and the angular momentum problem (resulting in a too massive bulge) is also reduced substantially: the rotation curves are nearly flat. Just as it is often observed in QSO absorption lines, our models produce substantial outflows from forming and active galaxies. At high redshifts we routinely find gas with few hundred km/s and occasionally 1000-2000 km/s. The density profile of dark matter is still consistent with a cuspy profile. The simulations reproduce this picture only if the resolution is very high: better than 50 pc, which is much better than the typical resolution in previous cosmological simulations. Our simulations of galaxy formation reach the resolution of 35 pc. (Abridged)