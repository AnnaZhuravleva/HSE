Context: This paper presents a method which can be used to calculate models of the global solar corona from observational data. Aims: We present an optimization method for computing nonlinear magnetohydrostatic equilibria in spherical geometry with the aim to obtain self-consistent solutions for the coronal magnetic field, the coronal plasma density and plasma pressure using observational data as input. Methods: Our code for the self-consistent computation of the coronal magnetic fields and the coronal plasma solves the non-force-free magnetohydrostatic equilibria using an optimization method. Previous versions of the code have been used to compute non-linear force-free coronal magnetic fields from photospheric measurements in Cartesian and spherical geometry, and magnetostatic-equilibria in Cartesian geometry. We test our code with the help of a known analytic 3D equilibrium solution of the magnetohydrostatic equations. The detailed comparison between the numerical calculations and the exact equilibrium solutions is made by using magnetic field line plots, plots of density and pressure and some of the usual quantitative numerical comparison measures. Results: We find that the method reconstructs the equilibrium accurately, with residual forces of the order of the discretisation error of the analytic solution. The correlation with the reference solution is better than 99.9% and the magnetic energy is computed accurately with an error of <0.1%. Conclusions: We applied the method so far to an analytic test case. We are planning to use this method with real observational data as input as soon as possible.