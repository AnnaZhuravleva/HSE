The excursion set theory of halo formation is modified by adopting the fractional Brownian motion, to account for possible correlation between merging steps. We worked out analytically the conditional mass function, halo merging rate and formation time distribution in the spherical collapse model. We also developed an approximation for the ellipsoidal collapse model and applied it to the calculation of the conditional mass function and the halo formation time distribution. For models in which the steps are positively correlated, the halo merger rate is enhanced when the accreted mass is less than $\sim 25M^*$, while for the negatively correlated case this rate is reduced. Compared with the standard model in which the steps are uncorrelated, the models with positively correlated steps produce more aged population in small mass halos and more younger population in large mass halos, while for the models with negatively correlated steps the opposite is true. An examination of simulation results shows that a weakly positive correlation between successive merging steps appears to fit best. We have also found a systematic effect in the measured mass function due to the finite volume of simulations. In future work, this will be included in the halo model to accurately predict the three point correlation function estimated from simulations.