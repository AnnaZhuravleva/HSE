We have used GADGET2 to simulate the formation of an elliptical galaxy in a cosmological dark matter halo with mass 3x10^12M_Sun/h. Using a stellar population synthesis model has allowed us to compute magnitudes, colours and surface brightness profiles. We have included a model to follow the growth of a central black hole and we have compared the results of simulations with and without feedback from AGNs. We have studied the interplay between cold gas accretion and merging in the development of galactic morphologies, the link between colour and morphology evolution, the effect of AGN feedback on the photometry of early type galaxies, the redshift evolution in the properties of quasar hosts, and the impact of AGN winds on the chemical enrichment of the intergalactic medium (IGM). We have found that the early phases of galaxy formation are driven by the accretion of cold filamentary flows, which form a disc at the centre of the dark matter halo. When the dark matter halo is sufficiently massive to support the propagation of a stable shock, cold accretion is shut down, and the star formation rate begins to decline. Mergers transform the disc into an elliptical galaxy, but also bring gas into the galaxy. Without a mechanism that removes gas from the merger remnants, the galaxy ends up with blue colours, atypical for its elliptical morphology. AGN feedback can solve this problem even with a fairly low heating efficiency. We have also demonstrated that AGN winds are potentially important for the metal enrichment of the IGM a high redshift.(abridged)