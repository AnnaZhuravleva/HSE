New observational techniques and sophisticated modelling methods has led to dramatic breakthroughs in our understanding of the interplay between the surface magnetism, atomic diffusion and atmospheric dynamics in chemically peculiar stars. Magnetic Doppler images, constructed using spectropolarimetric observations of Ap stars in all four Stokes parameters, reveal the presence of small-scale field topologies. Abundance Doppler mapping has been perfected to the level where distributions of many different chemical elements can be deduced self-consistently for one star. The inferred chemical spot structures are diverse and do not always trace underlying magnetic field geometry. Moreover, horizontal chemical inhomogeneities are discovered in non-magnetic CP stars and evolving chemical spots are observed for the first time in the bright mercury-manganese star alpha And. These results show that in addition to magnetic fields, another important non-magnetic structure formation mechanism acts in CP stars.