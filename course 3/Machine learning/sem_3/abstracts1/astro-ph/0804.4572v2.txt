We present a new numerical code which solves the general relativistic magneto-hydrodynamics (GRMHD) equations coupled to the Einstein equations for the evolution of a dynamical spacetime within the conformally-flat approximation. This code has been developed with the main objective of studying astrophysical scenarios in which both, high magnetic fields and strong gravitational fields appear, such as the magneto-rotational collapse of stellar cores, the collapsar model of GRBs, and the evolution of neutron stars. The code is based on an existing and thoroughly tested purely hydrodynamics code and on its extension to accommodate weakly magnetized fluids (passive magnetic field approximation). The numerical code we present here is based on high-resolution shock-capturing schemes to solve the GRMHD equations together with the flux constraint transport method to ensure the solenoidal condition of the magnetic field. Since the astrophysical applications envisaged do not deviate much from spherical symmetry, the conformal flatness condition approximation is used for the formulation of the Einstein equations. In addition, the code can handle several equations of state, from simple analytical expressions to microphysical tabulated ones. In this paper we present stringent tests of our new GRMHD numerical code, which show its ability to handle all aspects appearing in the astrophysical scenarios for which the code is intended, namely relativistic shocks, highly magnetized fluids, and equilibrium configurations of magnetized neutron stars. As an application, magneto-rotational core collapse simulations of a realistic progenitor are presented, comparing the results with our previous finding in the passive magnetic field approximation.