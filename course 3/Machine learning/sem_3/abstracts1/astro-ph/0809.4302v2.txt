The zonal flow in Jupiter's upper troposphere is organized into alternating retrograde and prograde jets, with a prograde (superrotating) jet at the equator. Existing models posit as the driver of the flow either differential radiative heating of the atmosphere or intrinsic heat fluxes emanating from the deep interior; however, they do not reproduce all large-scale features of Jupiter's jets and thermal structure. Here it is shown that the difficulties in accounting for Jupiter's jets and thermal structure resolve if the effects of differential radiative heating and intrinsic heat fluxes are considered together, and if upper-tropospheric dynamics are linked to a magnetohydrodynamic (MHD) drag that acts deep in the atmosphere. Baroclinic eddies generated by differential radiative heating can account for the off-equatorial jets; meridionally propagating equatorial Rossby waves generated by intrinsic convective heat fluxes can account for the equatorial superrotation. The zonal flow extends deeply into the atmosphere, with its speed changing with depth, up to depths at which the MHD drag acts. The theory is supported by simulations with an energetically consistent general circulation model of Jupiter's outer atmosphere. A simulation that incorporates differential radiative heating and intrinsic heat fluxes reproduces Jupiter's observed jets and thermal structure and makes testable predictions about as-yet unobserved aspects thereof. A control simulation that incorporates only differential radiative heating but not intrinsic heat fluxes produces off-equatorial jets but no equatorial superrotation; another control simulation that incorporates only intrinsic heat fluxes but not differential radiative heating produces equatorial superrotation but no off-equatorial jets.