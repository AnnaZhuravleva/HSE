We study the generation of magnetic fields during preheating within an scenario of hybrid inflation at the electroweak (EW) scale. We find that the non-perturbative and strongly out-of-equilibrium process of magnetic field production occurs along the lines predicted by Vachaspati many years ago. The system starts in the false vacuum at the end of inflation, and very quickly the initial quantum fluctuations of the Higgs field get amplified via long wavelength spinodal instabilities. The subsequent nucleation of the random Gaussian Higgs field bubbles (lumps) leads to EW symmetry breaking, and to the creation of $Z$-strings, which soon decay, along with longwave magnetic flux tubes with nontrivial helicity. The intensity and scales in these helical magnetic fields are consistent with their later development into the microgauss fields observed in galaxies and clusters of galaxies.